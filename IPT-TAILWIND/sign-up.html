<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Herdoza Fitness Center - Sign Up</title>
    <link rel="icon" type="image" href="./assets/herdoza-logo-trans.png" />
    <link rel="stylesheet" href="./src/output.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="./src/mystyles.css" />
    <script type="module" src="./scripts/auth-api.js"></script>
    <style>
      /* Background styles */
      body {
        background-image: linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.1),
            rgba(0, 0, 0, 0.7)
          ),
          url("./assets/Herdoza-background.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }

      /* Force input text color */
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="password"] {
        color: black !important;
      }

      /* Toast Notification Styles */
      .toast-notification {
        position: fixed;
        top: 1.5rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 1rem 1.5rem;
        border-radius: 8px;
        background-color: #22c55e;
        color: white;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 9999;
        opacity: 0;
        animation: fadeInOut 3s ease forwards;
      }

      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -100%);
        }
        15% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        85% {
          opacity: 1;
          transform: translate(-50%, 0);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -100%);
        }
      }

      .checkbox-error {
        border: 2px solid red;
        border-radius: 4px;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4);
        }
        70% {
          box-shadow: 0 0 0 5px rgba(255, 0, 0, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
        }
      }

      /* OTP Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 9999;
      }

      .modal.show {
        display: flex !important;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background-color: #1a1a1a;
        padding: 2rem;
        border-radius: 0.5rem;
        width: 90%;
        max-width: 400px;
        border: 1px solid #333;
        animation: modalFadeIn 0.3s;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .otp-input {
        letter-spacing: 0.5em;
        text-align: center;
        font-family: monospace;
        font-size: 1.5em;
      }

      /* Background styles */
      body {
        background-image: linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.1),
            rgba(0, 0, 0, 0.7)
          ),
          url("./assets/Herdoza-background.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }

      /* Add lighter semi-transparent overlay */
      .bg-overlay {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(0, 0, 0, 0.6) 100%
        );
        backdrop-filter: blur(2px);
        min-height: 100vh;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen text-white">
    <div
      class="flex flex-col md:flex-row bg-black-3 w-full max-w-4xl rounded-lg overflow-hidden shadow-lg js-create-acc"
    >
      <div
        class="flex flex-col items-center justify-center p-8 w-full md:w-1/2"
      >
        <div class="flex items-center mb-5">
          <img src="./assets/herdoza-logo-trans.png" alt="Logo" class="h-12" />
          <div class="orbitron font-bold text-sm ms-2">
            HERDOZA FITNESS CENTER
          </div>
        </div>

        <form id="signupForm" class="flex flex-col w-full">
          <div class="text-3xl font-bold mb-6 text-center">Sign Up</div>

          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label for="firstName" class="text-sm text-white"
                >First Name</label
              >
              <input
                type="text"
                id="firstName"
                required
                placeholder="Juan"
                class="border border-gray-300 rounded-md w-full bg-white p-2 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
              />
            </div>

            <div>
              <label for="lastName" class="text-sm text-white">Last Name</label>
              <input
                type="text"
                id="lastName"
                required
                placeholder="Dela Cruz"
                class="border border-gray-300 rounded-md w-full bg-white p-2 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
              />
            </div>
          </div>

          <div class="mb-4">
            <label for="email" class="block text-sm text-white">Email</label>
            <input
              type="email"
              id="email"
              required
              placeholder="example@gmail.com"
              class="border border-gray-300 rounded-md w-full bg-white p-2 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
              style="max-width: 100%; overflow: hidden; text-overflow: ellipsis"
            />
          </div>

          <div class="mb-4">
            <label for="contactNumber" class="text-sm text-white"
              >Contact Number</label
            >
            <input
              type="tel"
              id="contactNumber"
              required
              placeholder="+63 912 345 6789"
              class="border border-gray-300 rounded-md w-full bg-white p-2 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
            />
          </div>

          <div class="mb-4">
            <label for="password" class="text-sm text-white">Password</label>
            <div class="relative">
              <input
                type="password"
                id="password"
                placeholder="Enter your password"
                required
                class="border border-gray-300 rounded-md w-full bg-white p-2 pr-10 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
              />
              <button
                type="button"
                onclick="togglePasswordVisibility('password')"
                class="absolute top-0 right-0 h-full px-3 flex items-center justify-center"
                style="color: black !important"
              >
                <i
                  id="password-toggle-icon"
                  class="bi bi-eye-slash"
                  style="color: black !important"
                ></i>
              </button>
            </div>
            <p class="text-gray-400 text-xs mt-1">
              Must be at least 8 characters long
            </p>
          </div>

          <div class="mb-4">
            <label for="confirm-password" class="text-sm text-white"
              >Confirm Password</label
            >
            <div class="relative">
              <input
                type="password"
                id="confirm-password"
                placeholder="Re-enter your password"
                required
                class="border border-gray-300 rounded-md w-full bg-white p-2 pr-10 text-sm mt-1 focus:outline-none focus:ring-2 focus:ring-red-600 text-black"
              />
              <button
                type="button"
                onclick="togglePasswordVisibility('confirm-password')"
                class="absolute top-0 right-0 h-full px-3 flex items-center justify-center"
                style="color: black !important"
              >
                <i
                  id="confirm-password-toggle-icon"
                  class="bi bi-eye-slash"
                  style="color: black !important"
                ></i>
              </button>
            </div>
            <p class="text-gray-400 text-xs mt-1">
              Re-enter your password to confirm
            </p>
          </div>

          <div class="flex items-center text-xs mb-2">
            <div class="flex items-center" id="terms-checkbox-container">
              <input type="checkbox" id="agreeTerms" class="mr-2" required />
              <label for="agreeTerms">I Agree With Herdoza's Gym Fitness</label>
            </div>
            <a href="privacy-policy.html" class="text-red-500 ms-auto"
              ><u>Privacy Policy</u></a
            >
          </div>
          <div id="checkbox-error" class="text-red-500 text-xs mb-3 hidden">
            You must agree to the terms and privacy policy.
          </div>

          <div id="signup-error" class="text-red-500 text-sm mb-4 hidden"></div>

          <button
            type="submit"
            class="bg-red-600 px-6 py-2 rounded-lg hover:bg-red-700 transition text-white w-full text-lg js-signup-btn"
          >
            Create Account
          </button>
        </form>
      </div>

      <div
        class="bg-red-600 text-center flex flex-col justify-center items-center p-8 w-full md:w-1/2 lg:rounded-l-4xl"
      >
        <div class="mb-5 text-2xl font-bold">Welcome to Our Gym!</div>
        <div class="text-sm mb-4">Already have an account?</div>
        <a
          href="login.html"
          class="border border-white text-lg font-bold px-6 py-2 rounded-lg hover:bg-white hover:text-black transition"
        >
          Login
        </a>
      </div>
    </div>

    <!-- Import scripts -->
    <script type="module" src="./scripts/config.js"></script>
    <script type="module" src="./scripts/api-client.js"></script>
    <script type="module" src="./scripts/auth-api.js"></script>

    <script type="module">
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("signupForm");

        function showToast(message, type = "success") {
          const toast = document.createElement("div");
          toast.className = "toast-notification flex items-center gap-2";
          toast.innerHTML = `
            <i class="bi bi-${
              type === "success" ? "check-circle" : "exclamation-circle"
            } text-xl"></i>
            <span>${message}</span>
          `;
          document.body.appendChild(toast);

          setTimeout(() => {
            toast.remove();
          }, 3000);
        }

        if (form) {
          form.addEventListener("submit", async function (e) {
            e.preventDefault();

            const errorElement = document.getElementById("signup-error");
            errorElement.classList.add("hidden");

            // Validate form fields first
            const password = document.getElementById("password").value;
            const confirmPassword =
              document.getElementById("confirm-password").value;
            const firstName = document.getElementById("firstName").value;
            const lastName = document.getElementById("lastName").value;
            const email = document.getElementById("email").value;
            const contact = document.getElementById("contactNumber").value;

            // Validate passwords match
            if (password !== confirmPassword) {
              errorElement.textContent = "Passwords do not match";
              errorElement.classList.remove("hidden");
              return;
            }

            // Validate terms agreement
            const agreeTerms = document.getElementById("agreeTerms");
            if (!agreeTerms.checked) {
              document
                .getElementById("checkbox-error")
                .classList.remove("hidden");
              document
                .getElementById("terms-checkbox-container")
                .classList.add("checkbox-error");
              return;
            }

            // Create user data
            const userData = {
              id: Date.now().toString(),
              name: `${firstName} ${lastName}`,
              email: email,
              contact: contact,
              password: password,
              type: "Gym Fitness",
              membershipDuration: "1",
              paymentMethod: "Cash",
              status: "pending",
              timestamp: new Date().toISOString(),
              paymentStatus: "pending",
            };

            // Store in registrations for admin approval
            const registrations = JSON.parse(
              localStorage.getItem("registrations") || "[]"
            );

            // Check if email already exists
            if (registrations.some((r) => r.email === userData.email)) {
              errorElement.textContent =
                "Email already registered. Please use a different email.";
              errorElement.classList.remove("hidden");
              return;
            }

            registrations.push(userData);
            localStorage.setItem(
              "registrations",
              JSON.stringify(registrations)
            );

            // Initialize user-specific membership data
            const initialMembershipData = {
              daysLeft: 0,
              nextPaymentDate: null,
              fee: 0,
              purchaseDate: null,
              originalDuration: 0,
              type: "Gym Fitness",
              status: "pending",
              sessions: [],
              membershipId: "mem_" + Date.now().toString(),
            };

            // Store user data in a consistent format
            const userSessionData = {
              email: email,
              name: `${firstName} ${lastName}`,
              type: "Gym Fitness",
              token: "new-member",
              status: "pending",
              membershipExpiry: new Date(
                Date.now() + 30 * 24 * 60 * 60 * 1000
              ).toISOString(),
              timestamp: Date.now(),
              expiresIn: 24 * 60 * 60 * 1000, // 24 hours
            };

            // Store essential user data
            localStorage.setItem("userEmail", email);
            localStorage.setItem("userName", userSessionData.name);
            localStorage.setItem("userStatus", "pending");
            localStorage.setItem("userToken", "new-member");
            localStorage.setItem("userContact", contact);
            localStorage.setItem(
              `membershipData_${email}`,
              JSON.stringify(initialMembershipData)
            );
            localStorage.setItem(
              "userSession",
              JSON.stringify(userSessionData)
            );

            // Clean up any old data
            localStorage.removeItem("selectedService");
            localStorage.removeItem("bookingData");
            localStorage.removeItem("selectedTimeSlots");
            localStorage.removeItem("selectedDates");
            localStorage.removeItem("hasMembership");
            localStorage.removeItem("membershipData");
            localStorage.removeItem("membershipType");
            localStorage.removeItem("membershipStatus");

            // Show success toast and redirect
            showToast("Signup successful! Welcome to Herdoza Fitness!");
            setTimeout(() => {
              window.location.href = "login.html";
            }, 2000);
          });
        }

        // Reset checkbox error on checkbox change
        document
          .getElementById("agreeTerms")
          ?.addEventListener("change", function () {
            document.getElementById("checkbox-error").classList.add("hidden");
            document
              .getElementById("terms-checkbox-container")
              .classList.remove("checkbox-error");
          });

        // Make password toggle function globally accessible
        window.togglePasswordVisibility = function (fieldId) {
          const passwordField = document.getElementById(fieldId);
          const toggleIcon = document.getElementById(`${fieldId}-toggle-icon`);
          if (passwordField.type === "password") {
            passwordField.type = "text";
            toggleIcon.classList.remove("bi-eye-slash");
            toggleIcon.classList.add("bi-eye");
          } else {
            passwordField.type = "password";
            toggleIcon.classList.remove("bi-eye");
            toggleIcon.classList.add("bi-eye-slash");
          }
        };
      });
    </script>
  </body>
</html>
